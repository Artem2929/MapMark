#!/usr/bin/env node

const { spawn } = require('child_process');
const path = require('path');

console.log('üöÄ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π...\n');

// –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É
console.log('üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É...');
const frontendInstall = spawn('npm', ['install'], {
  stdio: 'inherit',
  shell: true
});

frontendInstall.on('close', (code) => {
  if (code !== 0) {
    console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É');
    process.exit(1);
  }
  
  console.log('‚úÖ –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ\n');
  
  // –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è –±–µ–∫–µ–Ω–¥—É
  console.log('üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –±–µ–∫–µ–Ω–¥—É...');
  const backendInstall = spawn('npm', ['install'], {
    cwd: path.join(__dirname, 'backend'),
    stdio: 'inherit',
    shell: true
  });
  
  backendInstall.on('close', (code) => {
    if (code !== 0) {
      console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –±–µ–∫–µ–Ω–¥—É');
      process.exit(1);
    }
    
    console.log('‚úÖ –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –±–µ–∫–µ–Ω–¥—É –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
    console.log('\nüéâ –í—Å—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!');
    console.log('üí° –¢–µ–ø–µ—Ä –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –ø—Ä–æ—î–∫—Ç –∫–æ–º–∞–Ω–¥–æ—é: npm run dev');
  });
});