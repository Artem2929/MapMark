#!/bin/bash

echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº Ð±ÐµÐºÐµÐ½Ð´Ñƒ Ð´Ð»Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð¸ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½ÑŒ..."

# ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ð½Ð°ÑÐ²Ð½Ð¾ÑÑ‚Ñ– Node.js
if ! command -v node &> /dev/null; then
    echo "âŒ Node.js Ð½Ðµ Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾. Ð‘ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ñ–Ñ‚ÑŒ Node.js"
    exit 1
fi

# ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ð½Ð°ÑÐ²Ð½Ð¾ÑÑ‚Ñ– npm
if ! command -v npm &> /dev/null; then
    echo "âŒ npm Ð½Ðµ Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾. Ð‘ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ñ–Ñ‚ÑŒ npm"
    exit 1
fi

# ÐŸÐµÑ€ÐµÑ…Ñ–Ð´ Ð´Ð¾ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ñ–Ñ— Ð±ÐµÐºÐµÐ½Ð´Ñƒ
cd backend/server

# Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚ÐµÐ¹
echo "ðŸ“¦ Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚ÐµÐ¹..."
npm install

# ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ð½Ð°ÑÐ²Ð½Ð¾ÑÑ‚Ñ– .env Ñ„Ð°Ð¹Ð»Ñƒ
if [ ! -f .env ]; then
    echo "âš ï¸  Ð¤Ð°Ð¹Ð» .env Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾. Ð¡Ñ‚Ð²Ð¾Ñ€ÑŽÑŽ Ð· Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´Ñƒ..."
    cat > .env << EOL
PORT=3001
DB_URL=mongodb://localhost:27017/mapmark
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
NODE_ENV=development
EOL
    echo "âœ… Ð¤Ð°Ð¹Ð» .env ÑÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð¾. Ð‘ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, Ð½Ð°Ð»Ð°ÑˆÑ‚ÑƒÐ¹Ñ‚Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¸ Ð¿Ñ–Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ Ð´Ð¾ Ð±Ð°Ð·Ð¸ Ð´Ð°Ð½Ð¸Ñ…."
fi

# Ð—Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²ÐµÑ€Ð°
echo "ðŸŒ Ð—Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²ÐµÑ€Ð° Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 3001..."
echo "ðŸ“¡ WebSocket ÑÐµÑ€Ð²ÐµÑ€ Ð±ÑƒÐ´Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¸Ð¹ Ð½Ð° ws://localhost:3001"
echo "ðŸ”— API Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½ÑŒ: http://localhost:3001/api/messages"
echo ""
echo "Ð”Ð»Ñ Ð·ÑƒÐ¿Ð¸Ð½ÐºÐ¸ ÑÐµÑ€Ð²ÐµÑ€Ð° Ð½Ð°Ñ‚Ð¸ÑÐ½Ñ–Ñ‚ÑŒ Ctrl+C"
echo ""

npm start