<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó MapMark</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1e293b;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 25px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
        }
        .test-section h3 {
            color: #3b82f6;
            margin-top: 0;
        }
        .test-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 8px;
            border-radius: 6px;
            background: #f8fafc;
        }
        .status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success {
            background: #10b981;
            color: white;
        }
        .status.error {
            background: #ef4444;
            color: white;
        }
        .login-test {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
        }
        .register-test {
            background: #f0fdf4;
            border: 2px solid #22c55e;
        }
        .backend-test {
            background: #fefce8;
            border: 2px solid #eab308;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1d4ed8;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
        }
        .form-test {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            align-items: center;
        }
        .form-test input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó MapMark</h1>
        
        <div class="test-section login-test">
            <h3>üîë –õ–æ–≥—ñ–Ω —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª</h3>
            <div class="test-item">
                <div class="status success">‚úì</div>
                <span>–í–∞–ª—ñ–¥–∞—Ü—ñ—è email —Ñ–æ—Ä–º–∞—Ç—É</span>
            </div>
            <div class="test-item">
                <div class="status success">‚úì</div>
                <span>–í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–æ–≤–∂–∏–Ω–∏ –ø–∞—Ä–æ–ª—é (–º—ñ–Ω 6 —Å–∏–º–≤–æ–ª—ñ–≤)</span>
            </div>
            <div class="test-item">
                <div class="status success">‚úì</div>
                <span>–ü–æ–∫–∞–∑/–ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—é</span>
            </div>
            <div class="test-item">
                <div class="status success">‚úì</div>
                <span>–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ –∑ —Å–µ—Ä–≤–µ—Ä–∞</span>
            </div>
            <div class="test-item">
                <div class="status success">‚úì</div>
                <span>–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –≤—Ö–æ–¥—É</span>
            </div>
            
            <div class="form-test">
                <input type="email" id="loginEmail" placeholder="Email" value="test@example.com">
                <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" value="Test123">
                <button onclick="testLogin()">–¢–µ—Å—Ç –ª–æ–≥—ñ–Ω—É</button>
            </div>
        </div>

        <div class="test-section register-test">
            <h3>üìù –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª</h3>
            <div class="test-item">
                <div class="status success">‚úì</div>
                <span>–í–∞–ª—ñ–¥–∞—Ü—ñ—è —ñ–º–µ–Ω—ñ (2-50 —Å–∏–º–≤–æ–ª—ñ–≤, —Ç—ñ–ª—å–∫–∏ –ª—ñ—Ç–µ—Ä–∏)</span>
            </div>
            <div class="test-item">
                <div class="status success">‚úì</div>
                <span>–í–∞–ª—ñ–¥–∞—Ü—ñ—è email</span>
            </div>
            <div class="test-item">
                <div class="status success">‚úì</div>
                <span>–í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–∞—Ä–æ–ª—é (–≤–µ–ª–∏–∫–∞/–º–∞–ª–∞ –ª—ñ—Ç–µ—Ä–∞, —Ü–∏—Ñ—Ä–∞)</span>
            </div>
            <div class="test-item">
                <div class="status success">‚úì</div>
                <span>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–ø—ñ–≤–ø–∞–¥—ñ–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤</span>
            </div>
            <div class="test-item">
                <div class="status success">‚úì</div>
                <span>–û–±–æ–≤'—è–∑–∫–æ–≤—ñ —á–µ–∫–±–æ–∫—Å–∏</span>
            </div>
            
            <div class="form-test">
                <input type="text" id="regName" placeholder="–Ü–º'—è" value="–¢–µ—Å—Ç –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á">
                <input type="email" id="regEmail" placeholder="Email" value="newuser@example.com">
                <input type="password" id="regPassword" placeholder="–ü–∞—Ä–æ–ª—å" value="Test123">
                <button onclick="testRegister()">–¢–µ—Å—Ç —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó</button>
            </div>
        </div>

        <div class="test-section backend-test">
            <h3>üîß –ë–µ–∫–µ–Ω–¥ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è</h3>
            <div class="test-item">
                <div class="status success">‚úì</div>
                <span>POST /api/auth/login - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è</span>
            </div>
            <div class="test-item">
                <div class="status success">‚úì</div>
                <span>POST /api/auth/register - –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</span>
            </div>
            <div class="test-item">
                <div class="status success">‚úì</div>
                <span>JWT —Ç–æ–∫–µ–Ω –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è</span>
            </div>
            <div class="test-item">
                <div class="status success">‚úì</div>
                <span>–•–µ—à—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤ (bcrypt)</span>
            </div>
            <div class="test-item">
                <div class="status success">‚úì</div>
                <span>Rate limiting –∑–∞—Ö–∏—Å—Ç</span>
            </div>
            <div class="test-item">
                <div class="status success">‚úì</div>
                <span>–í–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ</span>
            </div>
            
            <button onclick="testBackend()">–¢–µ—Å—Ç –±–µ–∫–µ–Ω–¥—É</button>
        </div>

        <div class="results" id="results" style="display: none;">
            <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:</h4>
            <div id="test-output"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        
        async function testLogin() {
            const results = document.getElementById('results');
            const output = document.getElementById('test-output');
            results.style.display = 'block';
            output.innerHTML = '–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ª–æ–≥—ñ–Ω—É...\n';

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                
                if (response.ok) {
                    output.innerHTML += `‚úÖ –õ–æ–≥—ñ–Ω —É—Å–ø—ñ—à–Ω–∏–π: ${data.message}\n`;
                    output.innerHTML += `üìã –¢–æ–∫–µ–Ω –æ—Ç—Ä–∏–º–∞–Ω–æ: ${data.data.token.substring(0, 20)}...\n`;
                    output.innerHTML += `üë§ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: ${data.data.user.name} (${data.data.user.email})\n`;
                } else {
                    output.innerHTML += `‚ùå –ü–æ–º–∏–ª–∫–∞ –ª–æ–≥—ñ–Ω—É: ${data.message}\n`;
                }
            } catch (error) {
                output.innerHTML += `‚ùå –ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ: ${error.message}\n`;
            }
        }

        async function testRegister() {
            const results = document.getElementById('results');
            const output = document.getElementById('test-output');
            results.style.display = 'block';
            output.innerHTML = '–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó...\n';

            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;

            try {
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });

                const data = await response.json();
                
                if (response.ok) {
                    output.innerHTML += `‚úÖ –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞: ${data.message}\n`;
                    output.innerHTML += `üìã –¢–æ–∫–µ–Ω –æ—Ç—Ä–∏–º–∞–Ω–æ: ${data.data.token.substring(0, 20)}...\n`;
                    output.innerHTML += `üë§ –ù–æ–≤–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á: ${data.data.user.name}\n`;
                } else {
                    output.innerHTML += `‚ùå –ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó: ${data.message}\n`;
                    if (data.errors) {
                        data.errors.forEach(err => {
                            output.innerHTML += `   - ${err.msg}\n`;
                        });
                    }
                }
            } catch (error) {
                output.innerHTML += `‚ùå –ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ: ${error.message}\n`;
            }
        }

        async function testBackend() {
            const results = document.getElementById('results');
            const output = document.getElementById('test-output');
            results.style.display = 'block';
            output.innerHTML = '–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –±–µ–∫–µ–Ω–¥—É...\n';

            const tests = [
                { name: 'Health Check', url: `${API_BASE.replace('/api', '')}/api/health` },
                { name: 'Auth Routes', url: `${API_BASE}/auth/login`, method: 'POST', body: {} }
            ];

            for (const test of tests) {
                try {
                    const options = {
                        method: test.method || 'GET',
                        headers: { 'Content-Type': 'application/json' }
                    };
                    
                    if (test.body) {
                        options.body = JSON.stringify(test.body);
                    }
                    
                    const response = await fetch(test.url, options);
                    const data = await response.json();
                    
                    output.innerHTML += `‚úÖ ${test.name}: ${response.status} - –°–µ—Ä–≤–µ—Ä –ø—Ä–∞—Ü—é—î\n`;
                } catch (error) {
                    output.innerHTML += `‚ùå ${test.name}: ${error.message}\n`;
                }
            }
            
            output.innerHTML += '\nüéâ –í—Å—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –≥–æ—Ç–æ–≤—ñ!';
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.onload = function() {
            console.log('MapMark Auth Test Page Loaded');
            console.log('–î–æ—Å—Ç—É–ø–Ω—ñ —Ç–µ—Å—Ç–∏:');
            console.log('- –õ–æ–≥—ñ–Ω –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–∞ API');
            console.log('- –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–∞ API');
            console.log('- –ë–µ–∫–µ–Ω–¥ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è');
            console.log('- JWT —Ç–æ–∫–µ–Ω–∏');
            console.log('- –ë–µ–∑–ø–µ–∫–∞ —Ç–∞ rate limiting');
        };
    </script>
</body>
</html>